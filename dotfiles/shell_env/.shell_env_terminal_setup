###############################################################################
#                                                                             #
#             TERMINAL SETTINGS, APPEARENCE AND USAGE SETUP                   #
#                                                                             #
###############################################################################

###############################################################################
#  Run once                                                                   #
###############################################################################
_NEW_DOTFILES_TERMINAL_ENV="$0|$@|$-"
if [ ! -z "${DOTFILES_TERMINAL_ENV:-}" ] && [ "$DOTFILES_TERMINAL_ENV" = "$_NEW_DOTFILES_TERMINAL_ENV" ]; then
    return
fi
export DOTFILES_TERMINAL_ENV="$_NEW_DOTFILES_TERMINAL_ENV"


###############################################################################
#  Source all files from $DOTFILES_HOME/terminal-config                       #
###############################################################################

_shell_specific_file_extension="$_dotfiles_shell_name"
echo "CURRENT SHELL: $_shell_specific_file_extension"

_terminal_config_file_names="$(
    ls -l1 $DOTFILES_HOME/terminal-config
)"

while read -r _file_name; do
    if printf "$_file_name" | grep -v '\.' > /dev/null; then
        echo "Sourcing $DOTFILES_HOME/terminal-config/$_file_name"
        . "$DOTFILES_HOME/terminal-config/$_file_name"
    else
        if [ "${_file_name%$_shell_specific_file_extension}" != "$_file_name" ]; then
            echo "=== Sourcing for shell $_shell_specific_file_extension: $DOTFILES_HOME/terminal-config/$_file_name"
            . "$DOTFILES_HOME/terminal-config/$_file_name"
            continue
        fi
        # config file is not for this shell
        # echo "=== NOT VALID for shell $_shell_specific_file_extension: $_file_name"
    fi
done <<< "$(printf "%s\n" "$_terminal_config_file_names")"


###############################################################################
#  Shell program specific stuff                                               #
###############################################################################

if [ -r ".shell_env_terminal_setup.${_shell_specific_file_extension}" ]; then
    . ".shell_env_terminal_setup.${_shell_specific_file_extension}"
fi